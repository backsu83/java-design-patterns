# 스테이트 패턴(State Pattern)

## 1. 스테이트 패턴이란?

실세계의 많은 개체들은 자신이 처한 상황에 따라 일을 다르게 수행한다. 예를 들어 비가 오거나 눈이 오거나 사람이 붐비는 장소에 있거나에 
따라 걷는 방식과 말하는 방식이 달라지는 것과 같다. 

이를 표현하는 가장 직접적이고, 직관적인 방법은 일을 수행할 때 상태에 따라 상태 하나하나를 검사해 일을 다르게 수행하게 끔 하는 것이다. 
하지만 이는 분명 복잡한 조건식이 있는 코드를 산출할 것이고, 결과적으로 코드를 이해하거나 수정하기 어렵게 만들 것이다.

위의 방식과 달리 스테이트 패턴은 어떤 행위를 수행할 때 상태에 행위를 수행하도록 위임한다. 이를 위해 스테이트 패턴에서는 **시스템의 각 
상태를 클래스로 분리해 표현하고, 각 클래스에서 수행하는 행위들을 메서드로 구현한다. 그리고 이러한 상태들을 외부로부터 캡슐화하기 
위해 인터페이스를 만들어 시스템의 각 상태를 나타내는 클래스로 하여금 실체화하게 한다.**

![스테이트 패턴의 컬레보레이션](http://www.plantuml.com/plantuml/png/fP1D2i8m44RtESKiMwI59ZjnvmK4Jn3hY86OO3A2K7jtq_mejZkRtJputam-KgGHZYG9uI29q1dOMwtboJf9oXh6UYsz3z0GFWa61k4ruAV8DYKZse33-mCzTLNz2_WSY0_mID5GHHraNyr6nbJOvowoBzSDEN93kjhpTqcQ-MoULepbzYZeLXluQeFupr2wjqtkEpMoUxLj_jk2y0KHRm00)

스테이트 패턴에서 나타나는 역할이 수행하는 작업은 아래와 같다.

- `State` : 시스템의 모든 상태에 공통 인터페이스를 제공한다. 이 인터페이스를 실체화한 어떤 상태 클래스도 기존 상태 클래스를 대신해 
교체해서 사용할 수 있다.

- `State1`, `State2`, `State3` : `Context` 객체가 요청한 작업을 자신의 방식으로 실제 실행한다. 대부분의 경우 다음 상태를 결정해 
상태 변경을 `Context` 객체에 요청하는 역할도 수행한다.

- `Context` : `State`를 이용하는 역할을 수행한다. 현재 시스템의 상태를 나타내는 상태 변수(`state`)와 실제 시스템의 상태를 구성하는
여러가지 변수가 있다. 또한 각 상태 클래스에서 상태 변경을 요청해 상태를 바꿀 수 있도록하는 메서드(`setState()`)가 제공된다. `Context`
요소를 구현한 클래스의 `request()`메서드는 실제 행위를 실행하는 대신 해당 상태 객체에 행위 실행을 위임한다.

인터페이스의 메서드는 각 상태에서 수행해야하는 행위들이며, 상태 변경은 상태 스스로 알아서 다음 상태를 결정한다. 물론 경우에 따라 상태 
변경을 관리하는 클래스를 따로 만드는 방법도 생각해볼 수 있다. 이런 경우에는 각 상태 클래스만 보고서는 해당 상태로 변경되는지 알 수 없고
상태 변경을 관리하는 클래스를 살펴봐야한다.

스테이트 패턴에서 `Context` 요소는 상태 클래스를 이용해 일을 수행하도록 지시한다. 이 요소를 구현한 클래스에는 현재 상태를 나타내는 `state`
변수가 있어 이에 바인딩되는 객체에 행위를 수행하도록 위임하는 책임이 있다. 이러한 `state` 변수의 변경은 각 상태 클래스의 객체가 다음 상태
객체를 `Context` 요소를 구현한 클래스에 알려줌으로써 이루어진다. 따라서 `Context` 요소는 현재 시스템의 상태와 무관하다.

**스테이트 패턴은 상태에 따라 동일한 작업이 다른 방식으로 실행될 때 해당 상태가 작업을 수행하도록 위임하는 디자인 패턴이다.**

## 2. 상태 머신 다이어그램
UML에서 상태와 상태 변화를 모델링하는 도구로 상태 머신 다이어그램(State Machine Diagram)이 있다.

## 3. 스테이트 패턴 예제 : 형광등

#### 2.1 코드

#### 2.2 문제점

#### 2.3 해결책